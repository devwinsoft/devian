// <auto-generated>
// DO NOT EDIT - Generated by Devian Build System
// </auto-generated>

using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;

namespace Devian.Tools.Generators
{

    /// <summary>
    /// C# 라이브러리 스캐폴드 생성기
    /// .csproj 파일 생성
    /// </summary>
    public static class CSharpLibraryScaffoldGenerator
    {
        /// <summary>
        /// .csproj 파일 생성
        /// </summary>
        public static string GenerateCsproj(string ns, List<string>? projectRefs = null)
        {
            var sb = new StringBuilder();

            sb.AppendLine("<Project Sdk=\"Microsoft.NET.Sdk\">");
            sb.AppendLine();
            sb.AppendLine("  <PropertyGroup>");
            sb.AppendLine("    <TargetFramework>netstandard2.1</TargetFramework>");
            sb.AppendLine("    <LangVersion>latest</LangVersion>");
            sb.AppendLine("    <Nullable>enable</Nullable>");
            sb.AppendLine($"    <RootNamespace>{ns}</RootNamespace>");
            sb.AppendLine("  </PropertyGroup>");

            if (projectRefs != null && projectRefs.Count > 0)
            {
                sb.AppendLine();
                sb.AppendLine("  <ItemGroup>");
                foreach (var projRef in projectRefs)
                {
                    sb.AppendLine($"    <ProjectReference Include=\"{projRef}\" />");
                }
                sb.AppendLine("  </ItemGroup>");
            }

            sb.AppendLine();
            sb.AppendLine("</Project>");

            return sb.ToString();
        }

        /// <summary>
        /// 스캐폴드 파일 생성 (덮어쓰기 금지)
        /// </summary>
        public static void EnsureScaffold(string targetDir, string ns, List<string>? projectRefs = null)
        {
            var projName = ns.Split('.').Last();
            var csprojPath = Path.Combine(targetDir, $"{projName}.csproj");

            if (!Directory.Exists(targetDir))
                Directory.CreateDirectory(targetDir);

            // 이미 존재하면 덮어쓰지 않음
            if (File.Exists(csprojPath))
                return;

            var content = GenerateCsproj(ns, projectRefs);
            File.WriteAllText(csprojPath, content);
        }
    }
}
