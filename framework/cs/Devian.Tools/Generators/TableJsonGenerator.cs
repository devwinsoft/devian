// <auto-generated>
// DO NOT EDIT - Generated by Devian Build System
// </auto-generated>

using Devian.Tools.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.Json;

namespace Devian.Tools.Generators
{

    /// <summary>
    /// 테이블 데이터 JSON 생성기
    /// Excel 데이터 → JSON 변환
    /// </summary>
    public static class TableJsonGenerator
    {
        /// <summary>
        /// 테이블 데이터 JSON 생성
        /// </summary>
        public static string Generate(TableSpec spec, List<Dictionary<string, object>> rows)
        {
            var data = new
            {
                meta = new
                {
                    domain = spec.Domain,
                    tableName = spec.TableName,
                    sheetKey = spec.SheetKey,
                    rowTypeName = spec.RowTypeName,
                    primaryKeyField = spec.PrimaryKeyFieldName,
                    rowCount = rows.Count
                },
                rows = rows
            };

            var options = new JsonSerializerOptions 
            { 
                WriteIndented = true,
                PropertyNamingPolicy = JsonNamingPolicy.CamelCase
            };

            return JsonSerializer.Serialize(data, options);
        }

        /// <summary>
        /// TableMeta JSON 생성
        /// </summary>
        public static string GenerateMeta(TableSpec spec)
        {
            var meta = new TableMeta
            {
                Domain = spec.Domain,
                ExcelFileName = spec.ExcelFileName,
                SheetName = spec.SheetName,
                TableName = spec.TableName,
                SheetKey = spec.SheetKey,
                RowTypeName = spec.RowTypeName,
                PrimaryKeyColumnIndex = spec.PrimaryKeyColumnIndex,
                PrimaryKeyFieldName = spec.PrimaryKeyFieldName,
                PrimaryKeyTypeKey = spec.PrimaryKeyTypeKey,
                Columns = spec.Columns.Select(c => new ColumnMeta
                {
                    Name = c.Name,
                    Type = c.Type,
                    Comment = c.Comment,
                    IsArray = c.IsArray,
                    IsRef = c.IsRef,
                    RefTypeName = c.RefTypeName,
                    IsCommonRef = c.IsCommonRef
                }).ToList()
            };

            var options = new JsonSerializerOptions { WriteIndented = true };
            return JsonSerializer.Serialize(meta, options);
        }
    }
}
