using System.Text;
using Devian.Tools.Generators;

namespace Devian.Tools.Generators
{
    /// <summary>
    /// Contract Spec(JSON)에서 TypeScript 타입(enum, interface)을 생성한다.
    /// </summary>
    public static class TypeScriptContractGenerator
    {
        /// <summary>
        /// enum 하나를 TypeScript 코드로 생성
        /// </summary>
        public static string GenerateEnum(EnumSpec spec)
        {
            var sb = new StringBuilder();
            sb.AppendLine("// <auto-generated>");
            sb.AppendLine("// DO NOT EDIT - Generated by Devian.Tools");
            sb.AppendLine("// </auto-generated>");
            sb.AppendLine();
            sb.AppendLine(string.Format("export enum {0} {{", spec.Name));
            
            for (int i = 0; i < spec.Values.Count; i++)
            {
                var val = spec.Values[i];
                var comma = (i < spec.Values.Count - 1) ? "," : "";
                sb.AppendLine(string.Format("  {0} = {1}{2}", val.Name, val.Value, comma));
            }
            
            sb.AppendLine("}");
            
            return sb.ToString();
        }
        
        /// <summary>
        /// class 하나를 TypeScript interface로 생성
        /// </summary>
        public static string GenerateInterface(ClassSpec spec)
        {
            var sb = new StringBuilder();
            sb.AppendLine("// <auto-generated>");
            sb.AppendLine("// DO NOT EDIT - Generated by Devian.Tools");
            sb.AppendLine("// </auto-generated>");
            sb.AppendLine();
            sb.AppendLine(string.Format("export interface {0} {{", spec.Name));
            
            foreach (var field in spec.Fields)
            {
                var tsType = TypeMapper.ToTypeScript(field.Type, field.Optional);
                var propName = TypeMapper.ToCamelCase(field.Name);
                var opt = field.Optional ? "?" : "";
                sb.AppendLine(string.Format("  {0}{1}: {2};", propName, opt, tsType));
            }
            
            sb.AppendLine("}");
            
            return sb.ToString();
        }
    }
}
