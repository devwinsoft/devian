// <auto-generated>
// DO NOT EDIT - Generated by Devian Build System v10
// </auto-generated>

#nullable enable

using System;
using System.Collections.Generic;
using System.IO;
using Newtonsoft.Json;
using Devian;

namespace Devian.Domain.Purchase
{
    // ================================================================
    // Table Entities
    // ================================================================

    /// <summary>PRODUCT row</summary>
    public sealed class PRODUCT : IEntityKey<string>
    {
        public string InternalProductId { get; set; } = string.Empty;
        public string Kind { get; set; } = string.Empty;
        public string StoreSkuApple { get; set; } = string.Empty;
        public string StoreSkuGoogle { get; set; } = string.Empty;

        public string GetKey() => InternalProductId;
    }

    // ================================================================
    // Table Containers
    // ================================================================

    /// <summary>TB_PRODUCT container</summary>
    public static partial class TB_PRODUCT
    {
        private static readonly Dictionary<string, PRODUCT> _dict = new();
        private static readonly List<PRODUCT> _list = new();

        public static int Count => _list.Count;

        public static void Clear()
        {
            _dict.Clear();
            _list.Clear();
        }

        public static IReadOnlyList<PRODUCT> GetAll() => _list;

        public static PRODUCT? Get(string key)
        {
            return _dict.TryGetValue(key, out var row) ? row : null;
        }

        public static bool TryGet(string key, out PRODUCT? row)
        {
            return _dict.TryGetValue(key, out row);
        }

        private static void AddRow(PRODUCT row)
        {
            _list.Add(row);
            _dict[row.InternalProductId] = row;
        }

        public static void LoadFromJson(string json)
        {
            Clear();
            var rows = JsonConvert.DeserializeObject<List<PRODUCT>>(json);
            if (rows == null) return;
            foreach (var row in rows)
            {
                if (row == null) continue;
                AddRow(row);
            }
        }

        public static void LoadFromNdjson(string ndjson)
        {
            Clear();
            using var reader = new StringReader(ndjson);
            string? line;
            while ((line = reader.ReadLine()) != null)
            {
                if (string.IsNullOrWhiteSpace(line)) continue;
                var row = JsonConvert.DeserializeObject<PRODUCT>(line);
                if (row == null) continue;
                AddRow(row);
            }
        }

        public static void LoadFromPb64Binary(byte[] rawBinary)
        {
            Clear();
            Pb64Loader.ParseRows(rawBinary, jsonRow =>
            {
                if (string.IsNullOrWhiteSpace(jsonRow)) return;
                var row = JsonConvert.DeserializeObject<PRODUCT>(jsonRow);
                if (row == null) return;
                AddRow(row);
            });
        }

        // ====================================================================
        // AfterLoad Hook (optional)
        // Called by DomainTableRegistry after TableManager inserts data.
        // ====================================================================

        internal static void _AfterLoad()
        {
            _OnAfterLoad();
        }

        static partial void _OnAfterLoad();
    }

    // ================================================================
    // Table ID Types (for Inspector binding)
    // ================================================================

    /// <summary>Inspector-bindable ID for PRODUCT</summary>
    [Serializable]
    public sealed class PRODUCT_ID
    {
        public string Value;

        public static implicit operator string(PRODUCT_ID id) => id.Value;
        public static implicit operator PRODUCT_ID(string value) => new PRODUCT_ID { Value = value };
    }

    /// <summary>Table ID validation extensions</summary>
    public static class TableIdExtensions
    {
        public static bool IsValid(this PRODUCT_ID? obj) => obj != null && !string.IsNullOrEmpty(obj.Value);
    }

}