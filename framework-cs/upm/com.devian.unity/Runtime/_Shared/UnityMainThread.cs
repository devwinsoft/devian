// <auto-generated>
// Unity Shared - Main Thread Helper
// SSOT: skills/devian-common-upm/30-unity-components/00-unity-object-destruction/SKILL.md
// </auto-generated>

using System;
using System.Threading;
using UnityEngine;

namespace Devian
{
    /// <summary>
    /// Internal helper for main thread detection.
    /// Used by all Unity templates to enforce main thread constraint.
    /// </summary>
    internal static class UnityMainThread
    {
        private static int _mainThreadId = -1;
        
        [RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.BeforeSceneLoad)]
        private static void CaptureMainThread()
        {
            _mainThreadId = Thread.CurrentThread.ManagedThreadId;
        }
        
        /// <summary>
        /// Returns true if called from the main thread.
        /// </summary>
        public static bool IsMainThread => _mainThreadId == Thread.CurrentThread.ManagedThreadId;
        
        /// <summary>
        /// Throws InvalidOperationException if not on main thread.
        /// </summary>
        /// <param name="context">Description for error message (e.g., "PoolManager.Spawn")</param>
        public static void EnsureOrThrow(string context)
        {
            if (!IsMainThread)
            {
                throw new InvalidOperationException(
                    $"[{context}] Must be called from the main thread. " +
                    "Unity API calls are not thread-safe.");
            }
        }
    }
}
