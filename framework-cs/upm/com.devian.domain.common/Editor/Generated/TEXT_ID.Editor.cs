// <auto-generated>
// DO NOT EDIT - Generated by Devian Build System v10
// StringTable ID Inspector binding
// SSOT: skills/devian-common/14-feature-string-table/SKILL.md
// </auto-generated>

#if UNITY_EDITOR

using System;
using System.Linq;
using UnityEditor;
using UnityEngine;
using Devian.Domain.Common;

namespace Devian
{
    /// <summary>Selector for StringTable TEXT_ID</summary>
    public class Common_TEXT_ID_Selector : EditorID_SelectorBase
    {
        protected override string GetDisplayTypeName() => "TEXT";

        [Serializable]
        private class StringEntry { public string id = string.Empty; public string text = string.Empty; }

        public override void Reload()
        {
            ClearItems();

            var textAssets = AssetManager.FindAssets<TextAsset>("TEXT");
            // Sort by path and pick first one (any language is fine, keys are same across languages)
            var sortedAssets = textAssets
                .Select(ta => new { Asset = ta, Path = AssetDatabase.GetAssetPath(ta) })
                .Where(x => x.Path.EndsWith(".json", StringComparison.OrdinalIgnoreCase))
                .OrderBy(x => x.Path)
                .ToList();

            if (sortedAssets.Count == 0) return;

            var ta = sortedAssets[0].Asset;
            var ndjsonLines = ta.text.Split(new[] { '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries);
            foreach (var line in ndjsonLines)
            {
                var trimmed = line.Trim();
                if (string.IsNullOrEmpty(trimmed)) continue;
                try
                {
                    var entry = JsonUtility.FromJson<StringEntry>(trimmed);
                    if (!string.IsNullOrEmpty(entry.id))
                        AddItem(entry.id);
                }
                catch { /* ignore parse errors */ }
            }
        }
    }

    /// <summary>PropertyDrawer for TEXT_ID</summary>
    [CustomPropertyDrawer(typeof(TEXT_ID))]
    public class Common_TEXT_ID_Drawer : EditorID_DrawerBase<Common_TEXT_ID_Selector>
    {
        protected override Common_TEXT_ID_Selector GetSelector()
        {
            var w = ScriptableObject.CreateInstance<Common_TEXT_ID_Selector>();
            w.titleContent = new GUIContent("Select TEXT");
            w.ShowUtility();
            return w;
        }
    }
}

#endif