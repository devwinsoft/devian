// <auto-generated>
// Unity Pool - PoolTag
// SSOT: skills/devian-unity/30-unity-components/02-pool-manager/SKILL.md
// </auto-generated>

using System;
using UnityEngine;

namespace Devian
{
    /// <summary>
    /// Marks a GameObject as spawned from a specific pool.
    /// Used by PoolManager to deterministically route Despawn calls.
    /// </summary>
    [DisallowMultipleComponent]
    public sealed class PoolTag : MonoBehaviour
    {
        /// <summary>
        /// The PoolId this instance belongs to.
        /// Set by PoolManager.TrackSpawned when the instance is spawned.
        /// </summary>
        public int PoolId { get; private set; }
        
        /// <summary>
        /// The pool name (prefab name) this instance was spawned with.
        /// Useful for debugging and hierarchy organization.
        /// </summary>
        public string PoolName { get; private set; }

        /// <summary>
        /// Whether this instance is currently spawned (active in the game).
        /// Used to prevent double-despawn issues.
        /// </summary>
        public bool IsSpawned { get; private set; }

        /// <summary>
        /// Marks the instance as spawned. Called by PoolManager after TrackSpawned.
        /// </summary>
        internal void MarkSpawned() => IsSpawned = true;

        /// <summary>
        /// Marks the instance as despawned. Called by Pool.Despawn at the start of despawn.
        /// </summary>
        internal void MarkDespawned() => IsSpawned = false;

        /// <summary>
        /// Sets the pool info. Only callable from within Devian assembly.
        /// Immutable after first set - throws if attempting to change values.
        /// </summary>
        internal void SetPoolInfo(int poolId, string poolName)
        {
            // Allow first set, or idempotent re-set to same values.
            if (PoolId != 0 && PoolId != poolId)
            {
                throw new InvalidOperationException("PoolTag.PoolId must never change.");
            }

            if (!string.IsNullOrEmpty(PoolName) && PoolName != poolName)
            {
                throw new InvalidOperationException("PoolTag.PoolName must never change.");
            }

            PoolId = poolId;
            PoolName = poolName;
        }
    }
}
